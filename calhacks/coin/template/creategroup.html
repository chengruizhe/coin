<html>
<head>
<title>create group</title>
<script   src="https://code.jquery.com/jquery-3.2.1.min.js"   integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="   crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
<style media="screen" type="text/css">
 #nav {
    z-index: 3;
    position: fixed;
    top: 0px;
    left: 0px;
    right: 0px;
    background-color: #443642;
    width: 100%;
    padding-top: 3px;
    padding-bottom: 3px;
}
  #navbar-item-logo {
    margin: 10px 10px 10px 10px;
    position: relative;
    top: 10px;
    display: inline-block;
    left: 250px;
  }
  .navbar-item, #navbar-item-l {
    position: relative;
    left: 100px;
    display: inline-block;
    color: white;
    text-align: center;
    font-size: 17px;
    margin: 10px 10px 15px 15px;
    letter-spacing: 3px;
    text-transform: uppercase;
    font-family: 'Josefin Sans', serif;
    cursor:pointer;
  }
  .navbar-item:hover {
    opacity: .8;
  }

  #navbar-item-l:hover {
    opacity: .8;
  }


  a:link {
  /* Applies to all unvisited links */
  text-decoration:  none;
  color:white;}

  a:visited {
    text-decoration:  none;
    color:white;
  }


  #navbar-item-l {
    position: relative;
  }

  #navbar-item-search {
     /*padding-bottom: 10px;*/
    display: inline-block;
    position: absolute;
    /*left: 100px;*/
    top:3px;
    bottom: 3px;
    right: 0px;
  }
  .searchbar {
    color: white;
    height: 35px;
    width: 100px;
    padding: 5px 5px 5px 5px;
    margin-left: 100px;
    margin-right: 10px;
    background: #443642;
    border:0px solid #dbdbdb;
    border-radius: 10px;
  }
  .searchbar:focus {
    width: 200px;
    margin-left: 0px;
    transition: 0.3s;}




  .camera {
    position: absolute;
    text-align: center;
    top: 120px;
    left:50%;
    transform: translateX(-50%);
  }

  #video {
    position: relative;
    /*width: 500px;*/
  }

  #startbutton {
    position: relative;
    /*display: inline-block;*/
    font-size: 14px;
    color: white;
    background: #3EB890;
    padding-top: 8px;
    padding-bottom: 8px;
    padding-left: 23px;
    padding-right: 23px;
    margin-top: 20px;
    margin-bottom: 10px;
    margin-left: 10px;
    margin-right: 10px;
    letter-spacing: 1px;
    font-family: 'Josefin Sans', serif;
  }
  
  #wrapper {
    text-align: center;
    z-index: 1
  }

  #canvas{
    position: relative;
    top: 360px;
    /*width: 500px;*/
    /*left:50%;
    transform: translateX(-50%);*/
  }

  .output{
    position: relative;
    top: 450px;
    /*left:50%;
    transform: translateX(-50%);*/
  }*/
</style>

</head>
<body background="/media/geom2.jpg">
    
  <div id="nav">
    <div id="navbar">
        <!-- <div id="navbar-item-logo"><img src="assets/img/logo.png" height="51px" width="101px"></div> -->
        <div class="navbar-item"><a style="text-decoration:none"  href='../createattend'>Take Attendance</a></div>
        <div class="navbar-item"><a href='../attendance'>Present Students</a></div>
        <div class="navbar-item"><a href='../monitor'>Monitor</a></div>
        <div class="navbar-item"><a href='../creategroup'>Create Group</a></div>
        <div id="navbar-item-l"><a href='../seegps'>See Groups</a></div>
        <div id="navbar-item-search"><input type="text" class="searchbar" ame="search" placeholder="Search.."></div>

      </div>
    </div>

<div id="wrapper">
<div class="camera">
    <video id="video">Video stream not available.</video>
    <button id="startbutton">Snap!</button>
</div>

<canvas id="canvas" style='display: none;'>
</canvas>

  <div class="output">
    <img id="photo" alt="The screen capture will appear in this box." style='display: none;'>
  </div>

  <div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" arialabelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
            	<h5 class="modal-title" id="exampleModalLabel">Group Photo</h5>
            	<button type="button" class="close" data-dismiss="modal" aria-label="Close">
          			<span aria-hidden="true">&times;</span>
        		</button>
            </div>
            <div class="modal-body">
            	<div>
            		<img id = 'confirmPic' src='' alt='loading' style='width:100%'/>
            	</div>
            	<form>
		          	<div class="form-group">
		            	<label for="group-name" class="form-control-label">Group name:</label>
		            	<input type="text" class="form-control" id="group-name">
		          	</div>
		          	<div class="form-group">
		            	<label for="group-description" class="form-control-label">Description:</label>
		            	<input type ="text" class="form-control" id="group-description"></textarea>
		          	</div>
		        </form>
		    </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button type="button " id="submitdb" class="btn btn-success success">Submit</button>
            </div>
        </div>
        </div>
    </div>
</body>
<script type="text/javascript">
	(function() {
	  // The width and height of the captured photo. We will set the
	  // width to the value defined here, but the height will be
	  // calculated based on the aspect ratio of the input stream.
	  var width = 600;    // We will scale the photo width to this
	  var height = 0;     // This will be computed based on the input stream
	  // |streaming| indicates whether or not we're currently streaming
	  // video from the camera. Obviously, we start at false.
	  var streaming = false;
	  // The various HTML elements we need to configure or control. These
	  // will be set by the startup() function.
	  var video = null;
	  var canvas = null;
	  var photo = null;
	  var startbutton = null;
	  var group_id = 0;

	  function startup() {
	    video = document.getElementById('video');
	    canvas = document.getElementById('canvas');
	    photo = document.getElementById('photo');
	    image = document.getElementById('image');
	    startbutton = document.getElementById('startbutton');
	    confirmPic = document.getElementById('confirmPic');
	    navigator.getMedia = ( navigator.getUserMedia ||
	                           navigator.webkitGetUserMedia ||
	                           navigator.mozGetUserMedia ||
	                           navigator.msGetUserMedia);
	    navigator.getMedia(
	      {
	        video: true,
	        audio: false
	      },
	      function(stream) {
	        if (navigator.mozGetUserMedia) {
	          video.mozSrcObject = stream;
	        } else {
	          var vendorURL = window.URL || window.webkitURL;
	          video.src = vendorURL.createObjectURL(stream);
	        }
	        video.play();
	      },
	      function(err) {
	        console.log("An error occured! " + err);
	      }
	    );
	    video.addEventListener('canplay', function(ev){
	      if (!streaming) {
	        height = video.videoHeight / (video.videoWidth/width);
	        // Firefox currently has a bug where the height can't be read from
	        // the video, so we will make assumptions if this happens.
	        if (isNaN(height)) {
	          height = width / (4/3);
	        }
	        video.setAttribute('width', width);
	        video.setAttribute('height', height);
	        canvas.setAttribute('width', width);
	        canvas.setAttribute('height', height);
	        streaming = true;
	      }
	    }, false);
	    startbutton.addEventListener('click', function(ev){
	      takepicture();
	      ev.preventDefault();
	    }, false);
	    clearphoto();
	  }
	  // Fill the photo with an indication that none has been
	  // captured.
	  function clearphoto() {
	    var context = canvas.getContext('2d');
	    context.fillStyle = "#AAA";
	    context.fillRect(0, 0, canvas.width, canvas.height);
	    var data = canvas.toDataURL('image/png');
	    photo.setAttribute('src', data);
	  }
	  // Capture a photo by fetching the current contents of the video
	  // and drawing it into a canvas, then converting that to a PNG
	  // format data URL. By drawing it on an offscreen canvas and then
	  // drawing that to the screen, we can change its size and/or apply
	  // other changes before drawing it.
	  function takepicture() {
	    var context = canvas.getContext('2d');
	    if (width && height) {
	      canvas.width = width;
	      canvas.height = height;
	      context.drawImage(video, 0, 0, width, height);
	      var data = canvas.toDataURL('image/png');
	      sendpic(data);
	      photo.setAttribute('src', data);
	      //confirmPic.setAttribute('src', data);
	    } else {
	      clearphoto();
	    }
	  }
	  function sendpic(data){
	  	$.ajax({
            url: '../creategroup/',
            dataType: 'json',
            method: 'POST',
            data: { pic :JSON.stringify(data)}
        })
	    .fail(function(data) {
	    	window.alert('wrong');
	    }).done(function(data){
	    	group_id = data['group_id']
	    	confirmPic.setAttribute('src', '');	
	    	$('#confirmModal').modal('show');
	    	confirmPic.setAttribute('src', '/media/plot.png');
	    })
	  }
	  window.addEventListener('load', startup, false);
	 //  $('confirmModal').on('show.bs.modal', function(event){
		// postData = {name: $('#group-name').val(), 
		// 			description: $('##group-description').val(),
		// 			id : group_id}
		// $.ajax({
		// 	url: '../ceategroup/',
		// 	dataType: 'json',
		// 	method: 'POST',
		// 	data: {confirm : JSON.stringify(postData)}
		// });
	 //  });
	  $("#confirmModal").on("hidden.bs.modal", function(event) {
    	location.reload();
	  });
	  // Set up our event listener to run the startup process
	  // once loading is complete.
	  $('#submitdb').on('click', function(event){
	  	$.ajax({
	  		url: '../creategroup/',
	  		dataType: 'json',
	  		method: 'POST',
	  		data: {name: $('#group-name').val(), description:$('#group-description').val(), group_id: group_id}
	  	}).done(function(data){
	  		link = data['link']
	  		$.ajax({
            url: '../slack/',
            dataType: 'json',
            method: 'GET',
            data: {pic :link}
        	});
	  	});
	  });
	})();
</script>
</html>